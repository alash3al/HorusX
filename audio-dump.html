<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Dump audio files online while you are listening to it" />
        <meta name="author" content="Mohammed Al Ashaal" />

        <title>Audio Dumper</title>

        <!-- Bootstrap core CSS -->
        <link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/cosmo/bootstrap.min.css" rel="stylesheet" />
        <!-- Add lobaster font CSS here -->
        <link href="//fonts.googleapis.com/css?family=Lobster|Cabin:400,700" rel="stylesheet" />
        <!-- Add font awesome CSS -->
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet" />

        <style>
            .font-lobaster {font-family: "Lobster";}
            body{padding: 5px;}
        </style>

    </head>
    <body>

        <div class="container center-block" style="max-width: 650px;">
            <h1 class="text-center font-lobaster">Audio Dumper</h1>
            <hr />

            <div class="row">
                <div class="col-md-9">
                    <input type="file" accept="audio/*" class="form-control" id="audio_file" />
                </div>
                <div class="col-md-3">
                    <button id="load" class="btn btn-success form-control"><span class="fa fa-cloud-upload"></span> Upload</button>
                </div>
            </div>
            <br />
            <textarea id="writer" class="form-control" style="min-height: 100px; max-width: 100%;"></textarea>
            <br />
            <audio src="" id="audio_src" controls="" autoplay="" style="width: 100%;">
                <p>Your browser does not support the audio element </p>
            </audio>
            <br /><br />
            <div class="panel panel-default" style="padding: 15px;">
                <ul>
                    <li>Play|Pause: <code>F5</code> .</li>
                    <li>Next: <code>right</code> .</li>
                    <li>Prev: <code>left</code> .</li>
                    <li>Inrease volume: <code>up</code> .</li>
                    <li>Decrease volume: <code>down</code> .</li>
                    <li>Decrease playback speed: <code>-</code> .</li>
                    <li>Increase playback speed: <code>+</code> .</li>
                </ul>
            </div>
            <hr />
            <div class="text-center" style="15px">
                Checkout <a target="_blank" href="//alash3al.github.io/HorusX/newsly.html">Newsly</a>
            </div>
        </div>

        <script src="//cdnjs.cloudflare.com/ajax/libs/store.js/1.3.14/store.min.js"></script>

        <!--  Pure javascript -->
        <!--
        Copyright (c) 2015, Mohammed Al Ashaal
        License MIT License
        -->
        <script>

            // convert file to base64
            // forked from <jsfiddle.net/eliseosoto/JHQnk/>
            // and edited by Mohammed Al Ashaal <is.gd/alash3al>
            function file2base64(file, mime_type, callback)
            {
                reader = new FileReader();
                reader.onload = function(readerEvt) {
                    console.log('initializing ...');
                    binaryString = readerEvt.target.result;
                    console.log('loading ...');
                    callback('data:'+mime_type+';base64,'+ btoa(binaryString));
                    console.log('loaded successfully');
                };
                reader.readAsBinaryString(file);
            }

            // --------------------

            // is string has arabic char or not ?
            // from <https://gist.github.com/alash3al/7408cbf3df69b2f6d7a7>
            // by Mohammed Al Ashaal <is.gd/alash3al>
            function has_ar(str)
            {
                var x = /[\u0600-\u06FF]+/;
                return x.test(str);
            }

            // --------------------

            // lets start our logic
            // when the window is ready .
            window.onload = function()
            {
                if ( typeof store.get('writer') == 'undefined' || typeof store.get('played') == 'undefined' ) {
                    store.set('writer', '');
                    store.set('played', 0);
                }

                $writer         =   document.getElementById('writer');
                $writer.value   =   store.get('writer');
                $audio          =   document.getElementById('audio_src');
                $uploader       =   document.getElementById('audio_file');
                $load           =   document.getElementById('load');

                // --------------------

                $load.addEventListener('click', function()
                {
                    document.title += ' -- ' + $uploader.value;
                    store.set('audio', $uploader.value);
                    $type = 'audio/' + document.title.split('.').pop();
                    file2base64($uploader.files[0], $type, function(src)
                    {
                        $audio.src      =   src;
                        $audio.play();
                    });
                }, false);

                // --------------------

                console.log(store.getAll());
                $writer.addEventListener('keydown', function(ev){
                    if ( has_ar($writer.value) )
                        $writer.dir = 'rtl';
                    else
                        $writer.dir = 'ltr';
                });

                // --------------------

                setInterval(function(){
                    store.set('writer', $writer.value);
                    store.set('played', $audio.currentTime);
                    console.log(store.get('dump'));
                }, 5000);

                window.onkeydown = function(ev)
                {
                    //console.log(ev.which);return false;
                    // F5 play/pause                                                            
                    if ( (ev.which == 116) )
                    {
                        if ( $audio.paused )
                            $audio.play();
                        else
                            $audio.pause();
                        return false;
                    }

                    // + volume
                    if ( (ev.which == 38) )
                    {
                        $audio.volume += 0.1;
                        return false;                        
                    }

                    // - volume
                    if ( (ev.which == 40) )
                    {
                        $audio.volume -= 0.1;
                        return false;
                    }

                    // + playpack-rate
                    if ( (ev.which == 107) )
                    {
                        $audio.playbackRate += 0.1;
                        return false;
                    }

                    // - playpack-rate
                    if ( (ev.which == 109) )
                    {
                        $audio.playbackRate -= 0.1;
                        return false;
                    }

                    // seek-next
                    if ( ev.which == 39 )
                    {
                        $audio.currentTime += 5;
                        return false;
                    }

                    // seek-prev
                    if ( ev.which == 37 )
                    {
                        $audio.currentTime -= 5;
                        return false;
                    }
                }

                // --------------------
            }

            
        </script>
    </body>
</html>
