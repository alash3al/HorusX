
<!--
    Don't steal anything { man } ^_^
    Author: Mohammed Al Ashaal,
    license: publish the link, put don't re-publish the source-code ;)
    Copyright: 2014
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Lets know what is going in the whole world in real time, just search to know" />
        <meta name="author" content="Mohammed Al Ashaal" />
        <link rel="shortcut icon" type="image/x-icon" href="http://icons.iconarchive.com/icons/pelfusion/long-shadow-ios7/32/News-icon.png" />

        <title>Newsly | What is new in the world news ?</title>

        <!-- Bootstrap core CSS -->
        <link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.2/cosmo/bootstrap.min.css" rel="stylesheet" />
        <!-- Add font awesome CSS -->
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet" />

        <style>
            body{padding: 5px; margin-top: 50px;}
        </style>

    </head>
    <body>
        <nav class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a href="#" class="dropdown-toggle navbar-brand" data-toggle="dropdown" ><span class="fa fa-windows"></span> Newsly</span></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <div class="navbar-form navbar-right" style="width: 80%;">
                <div class="form-group" style="width: 80%;">
                  <input autocomplete="off" type="text" style="width: 80%;" id="q" placeholder="what is in your mind ?" class="form-control" />
                </div>
              </div>
            </div><!--/.nav-collapse -->
          </div>
        </nav>

        <div class="container center-block" style="max-width: 650px;">

            <!-- TODO: <h1 class="text-center page-header font-lobaster"><span class="fa fa-bell"></span> Newsly</span></h1>
            <input class="form-control" type="text" placeholder="write and hit enter, e.g: sports, 'news' .. etc" id="q" />
            <br /> -->
            <div id="results"></div>
            <div id="more" class="form-control btn btn-success hidden">load more 8 items</div>
            <br />
            <br />
            <div class="lead well" style="padding: 15px;">
               A real-time news search engine, helps you to search about what you want and get results instantly .<br />
               This application uses google news api and search using it .
               You can easily convert this page to andriod/ios app using <a href="https://www.google.com.eg/search?q=website+to+mobile+app+converter" target="_blank">website to mobile app converter</a> .
               <br />
               <em class="text-muted"><small>Any issue contact <a target="_blank" href="//fb.com/alash3al">Mohammed Al Ashaal</em></small></b>
            </div>

        </div>

    <!-- JavaScript -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <script>

        /**
         * Check if string has an arabic char
         * @author Mohammed Alashaal <fb.com/alash3al>
         * @param element str
         * @return bool
         */
        function has_ar(str)
        {
            var x = /[\u0600-\u06FF]+/;
            return x.test(str);
        }

        /**
         * Auto Detect content direction [supports 'ar, en']
         * @author Mohammed Alashaal <fb.com/alash3al>
         * @return jQuery
         */
        $.fn.autodir = function(){
            if ( has_ar(this.val()) )
                this.attr('dir', 'rtl');
            else
                this.attr('dir', 'ltr');
            return this;  
        };

        /**
         * Fetch results from google news api
         * @author Mohammed Alashaal <fb.com/alash3al>
         * @return jQuery
         */
        $.fn.getResults = function($query, $start, $limit)
        {
            $this = this;
            $start = typeof $start == 'undefined' ? 0 : $start;
            $limit = typeof $limit == 'undefined' ? 8 : $limit;
            $.ajax
            ({
                crossDomain: true,
                dataType: 'Jsonp',
                url: 'https://ajax.googleapis.com/ajax/services/search/news?v=1.0&start='+$start+'&rsz='+$limit+'&q='+encodeURIComponent($query),//'https://ajax.googleapis.com/ajax/services/feed/find?v=1.0&num=25&q='+encodeURIComponent($(this).val()),
                success: function(r)
                {
                    //return console.log(r);
                    $i = 1;
                    var $entries = r.responseData.results;
                    for ( $k in $entries )
                    {
                        $RTL   = (has_ar($entries[$k]['content']) || has_ar($entries[$k]['title'])) ? 'rtl' : 'ltr';
                        
                        $item  = '<div dir="'+$RTL+'" class="panel panel-default" style="padding: 15px">';
                        $item += '<h4><a target="_blank" href="'+decodeURIComponent($entries[$k]['url'])+'">'+$entries[$k]['title']+'</a></h4>';
                        $item += '<p>'+$entries[$k]['content']+'</p>';
                        $item += '<a dir="ltr" class="text-success" href="'+decodeURIComponent($entries[$k]['url'])+'">'+decodeURIComponent($entries[$k]['url']).substr(0, 50)+' ...</a>';
                        $item += '</div>';
                        
                        $this.append($item);
                        ++ $i;
                    }
                }
            });

            return this;
        }

        // ---------------------------------------

        $(document).ready(function(){

            $start          =   0;
            $min_keywords   =   1;

            if ( $('#q').val().length < 1 )
                $('#results').html('');

            $('#q').keyup(function(e)
            {
                $(this).autodir();
                $('#more').addClass('hidden');

                $('#results').html('');
                $('#results').getResults($(this).val(), $start);
                $('#more').removeClass('hidden');

                if ( $(this).val().length < 1 ) {
                    $('#results').html('');
                    $('#more').addClass('hidden');
                }
            });

            $('#more').click(function()
            {
                if ( $('#q').val().length > 0 )
                {
                    $start += 8;
                    $('#results').getResults($('#q').val(), $start);
                }
            });
        });
    </script>
    </body>
</html>
